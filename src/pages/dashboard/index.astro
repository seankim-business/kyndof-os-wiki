---
import WikiLayout from '@layouts/WikiLayout.astro';

// In production, this would load from wiki/src/data/dashboard.json
// For now, using sample data to demonstrate the dashboard structure
const dashboardData = {
  goals: {
    totalGoals: 12,
    activeGoals: 8,
    completedGoals: 3,
    atRiskGoals: 2,
    averageProgress: 65,
    upcomingDeadlines: 3,
  },
  projects: {
    totalProjects: 15,
    activeProjects: 10,
    completedProjects: 4,
    atRiskProjects: 3,
    resourceUtilization: 78,
    avgVelocity: 72,
  },
  workload: {
    totalTeamMembers: 24,
    overloadedMembers: 3,
    underutilizedMembers: 2,
    avgTasksPerPerson: 4.2,
    avgHoursPerWeek: 38.5,
    burnoutRisk: 2,
  },
  kpis: {
    totalKPIs: 18,
    onTrackKPIs: 12,
    atRiskKPIs: 4,
    missingKPIs: 2,
    trendingUp: 9,
    trendingDown: 3,
  },
};

const getHealthColor = (percentage: number) => {
  if (percentage >= 80) return 'healthy';
  if (percentage >= 60) return 'warning';
  return 'critical';
};

const formatPercent = (value: number) => `${Math.round(value)}%`;
---

<WikiLayout title="Dashboard" description="Aggregation insights dashboard">
  <header class="dashboard-header">
    <div class="header-content">
      <div>
        <h1>Dashboard</h1>
        <p class="dashboard-description">
          Real-time insights into goals, projects, workload, and KPIs across your organization.
        </p>
      </div>
      <a href="/graph" class="graph-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="18" cy="18" r="3"></circle>
          <circle cx="6" cy="6" r="3"></circle>
          <circle cx="13" cy="13" r="2"></circle>
          <path d="M9 6h5l3 3"></path>
        </svg>
        View 3D Graph
      </a>
    </div>
  </header>

  <div class="dashboard-grid">
    <!-- Goals Module -->
    <a href="/dashboard/goals" class="dashboard-card">
      <div class="card-header">
        <div class="card-icon goals-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 6v6l4 2"></path>
          </svg>
        </div>
        <h2>Goals</h2>
      </div>
      <div class="card-stats">
        <div class="stat-row">
          <span class="stat-value">{dashboardData.goals.activeGoals}</span>
          <span class="stat-label">Active Goals</span>
        </div>
        <div class="stat-row">
          <span class="stat-value">{formatPercent(dashboardData.goals.averageProgress)}</span>
          <span class="stat-label">Avg Progress</span>
        </div>
      </div>
      <div class={`health-indicator ${getHealthColor(dashboardData.goals.averageProgress)}`}>
        {dashboardData.goals.atRiskGoals > 0 && (
          <span class="alert-badge">{dashboardData.goals.atRiskGoals} at risk</span>
        )}
      </div>
    </a>

    <!-- Projects Module -->
    <a href="/dashboard/projects" class="dashboard-card">
      <div class="card-header">
        <div class="card-icon projects-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <h2>Projects</h2>
      </div>
      <div class="card-stats">
        <div class="stat-row">
          <span class="stat-value">{dashboardData.projects.activeProjects}</span>
          <span class="stat-label">Active Projects</span>
        </div>
        <div class="stat-row">
          <span class="stat-value">{formatPercent(dashboardData.projects.avgVelocity)}</span>
          <span class="stat-label">Avg Velocity</span>
        </div>
      </div>
      <div class={`health-indicator ${getHealthColor(dashboardData.projects.avgVelocity)}`}>
        {dashboardData.projects.atRiskProjects > 0 && (
          <span class="alert-badge">{dashboardData.projects.atRiskProjects} at risk</span>
        )}
      </div>
    </a>

    <!-- Workload Module -->
    <a href="/dashboard/workload" class="dashboard-card">
      <div class="card-header">
        <div class="card-icon workload-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          </svg>
        </div>
        <h2>Workload</h2>
      </div>
      <div class="card-stats">
        <div class="stat-row">
          <span class="stat-value">{dashboardData.workload.totalTeamMembers}</span>
          <span class="stat-label">Team Members</span>
        </div>
        <div class="stat-row">
          <span class="stat-value">{dashboardData.workload.avgTasksPerPerson.toFixed(1)}</span>
          <span class="stat-label">Avg Tasks/Person</span>
        </div>
      </div>
      <div class={`health-indicator ${dashboardData.workload.overloadedMembers > 2 ? 'critical' : 'warning'}`}>
        {dashboardData.workload.overloadedMembers > 0 && (
          <span class="alert-badge">{dashboardData.workload.overloadedMembers} overloaded</span>
        )}
      </div>
    </a>

    <!-- KPIs Module -->
    <a href="/dashboard/kpis" class="dashboard-card">
      <div class="card-header">
        <div class="card-icon kpis-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="20" x2="12" y2="10"></line>
            <line x1="18" y1="20" x2="18" y2="4"></line>
            <line x1="6" y1="20" x2="6" y2="16"></line>
          </svg>
        </div>
        <h2>KPIs</h2>
      </div>
      <div class="card-stats">
        <div class="stat-row">
          <span class="stat-value">{dashboardData.kpis.onTrackKPIs}/{dashboardData.kpis.totalKPIs}</span>
          <span class="stat-label">On Track</span>
        </div>
        <div class="stat-row">
          <span class="stat-value">{dashboardData.kpis.trendingUp}</span>
          <span class="stat-label">Trending Up</span>
        </div>
      </div>
      <div class={`health-indicator ${getHealthColor((dashboardData.kpis.onTrackKPIs / dashboardData.kpis.totalKPIs) * 100)}`}>
        {dashboardData.kpis.atRiskKPIs > 0 && (
          <span class="alert-badge">{dashboardData.kpis.atRiskKPIs} at risk</span>
        )}
      </div>
    </a>
  </div>

  <!-- Quick Recommendations -->
  <section class="recommendations-section">
    <h2>Quick Recommendations</h2>
    <ul class="recommendation-list">
      {dashboardData.goals.atRiskGoals > 0 && (
        <li class="recommendation warning">
          <span class="recommendation-icon">‚ö†Ô∏è</span>
          <div>
            <strong>Goals at Risk:</strong> {dashboardData.goals.atRiskGoals} goals need attention. Review progress and adjust timelines.
          </div>
        </li>
      )}
      {dashboardData.workload.overloadedMembers > 0 && (
        <li class="recommendation critical">
          <span class="recommendation-icon">üî¥</span>
          <div>
            <strong>Workload Imbalance:</strong> {dashboardData.workload.overloadedMembers} team members are overloaded. Consider redistributing tasks.
          </div>
        </li>
      )}
      {dashboardData.projects.atRiskProjects > 0 && (
        <li class="recommendation warning">
          <span class="recommendation-icon">‚ö†Ô∏è</span>
          <div>
            <strong>Project Health:</strong> {dashboardData.projects.atRiskProjects} projects are at risk. Check velocity and blockers.
          </div>
        </li>
      )}
      {dashboardData.kpis.missingKPIs > 0 && (
        <li class="recommendation info">
          <span class="recommendation-icon">‚ÑπÔ∏è</span>
          <div>
            <strong>Missing Data:</strong> {dashboardData.kpis.missingKPIs} KPIs are missing recent data. Update tracking.
          </div>
        </li>
      )}
    </ul>
  </section>

  <div class="dashboard-footer">
    <a href="/" class="back-link">‚Üê Back to Wiki</a>
  </div>
</WikiLayout>

<style>
  .dashboard-header {
    margin-bottom: var(--spacing-xl);
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--spacing-lg);
  }

  .dashboard-header h1 {
    margin-bottom: var(--spacing-sm);
  }

  .dashboard-description {
    font-size: var(--text-lg);
    color: var(--text-secondary);
  }

  .graph-button {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-lg);
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    border-radius: var(--radius-md);
    text-decoration: none;
    font-weight: 600;
    font-size: var(--text-sm);
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .graph-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
  }

  .graph-button svg {
    width: 20px;
    height: 20px;
  }

  /* Dashboard Grid */
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
  }

  .dashboard-card {
    display: flex;
    flex-direction: column;
    padding: var(--spacing-lg);
    background: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .dashboard-card:hover {
    border-color: var(--accent-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
  }

  .card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: var(--radius-md);
    color: white;
  }

  .goals-icon {
    background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
  }

  .projects-icon {
    background: linear-gradient(135deg, #16a34a 0%, #4ade80 100%);
  }

  .workload-icon {
    background: linear-gradient(135deg, #0891b2 0%, #22d3ee 100%);
  }

  .kpis-icon {
    background: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
  }

  .card-header h2 {
    margin: 0;
    font-size: var(--text-xl);
    color: var(--text-primary);
  }

  .card-stats {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
  }

  .stat-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
  }

  .stat-value {
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--text-primary);
  }

  .stat-label {
    font-size: var(--text-sm);
    color: var(--text-muted);
  }

  /* Health Indicators */
  .health-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-weight: 600;
    margin-top: auto;
  }

  .health-indicator.healthy {
    background: rgba(22, 163, 74, 0.1);
    color: #16a34a;
  }

  .health-indicator.warning {
    background: rgba(234, 88, 12, 0.1);
    color: #ea580c;
  }

  .health-indicator.critical {
    background: rgba(220, 38, 38, 0.1);
    color: #dc2626;
  }

  .alert-badge {
    display: inline-block;
  }

  /* Recommendations */
  .recommendations-section {
    margin-bottom: var(--spacing-2xl);
  }

  .recommendation-list {
    list-style: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .recommendation {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    border-left: 4px solid;
  }

  .recommendation.critical {
    background: rgba(220, 38, 38, 0.05);
    border-left-color: #dc2626;
  }

  .recommendation.warning {
    background: rgba(234, 88, 12, 0.05);
    border-left-color: #ea580c;
  }

  .recommendation.info {
    background: rgba(66, 99, 235, 0.05);
    border-left-color: #4263eb;
  }

  .recommendation-icon {
    font-size: 20px;
    flex-shrink: 0;
  }

  .recommendation strong {
    color: var(--text-primary);
  }

  /* Footer */
  .dashboard-footer {
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--border-color);
  }

  .back-link {
    color: var(--link-color);
    font-weight: 500;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }

    .header-content {
      flex-direction: column;
      align-items: stretch;
    }

    .graph-button {
      justify-content: center;
    }
  }
</style>
