---
import WikiLayout from '@layouts/WikiLayout.astro';

// Sample goal data - in production, this would be loaded from wiki/src/data/dashboard.json
const goalsData = {
  summary: {
    totalGoals: 12,
    activeGoals: 8,
    completedGoals: 3,
    onHoldGoals: 1,
    averageProgress: 65,
  },
  goals: [
    {
      id: 'goal-1',
      title: 'Launch Product v2.0',
      progress: 85,
      status: 'on-track',
      deadline: '2024-03-15',
      owner: 'Alice Johnson',
      milestones: { completed: 8, total: 10 },
    },
    {
      id: 'goal-2',
      title: 'Improve Customer Satisfaction',
      progress: 45,
      status: 'at-risk',
      deadline: '2024-02-28',
      owner: 'Bob Smith',
      milestones: { completed: 3, total: 8 },
    },
    {
      id: 'goal-3',
      title: 'Expand to APAC Market',
      progress: 92,
      status: 'on-track',
      deadline: '2024-04-01',
      owner: 'Carol White',
      milestones: { completed: 11, total: 12 },
    },
    {
      id: 'goal-4',
      title: 'Reduce Infrastructure Costs',
      progress: 30,
      status: 'at-risk',
      deadline: '2024-03-01',
      owner: 'Dave Brown',
      milestones: { completed: 2, total: 6 },
    },
    {
      id: 'goal-5',
      title: 'Build Mobile App',
      progress: 68,
      status: 'on-track',
      deadline: '2024-05-15',
      owner: 'Eve Davis',
      milestones: { completed: 5, total: 7 },
    },
  ],
};

const getStatusColor = (status: string) => {
  switch (status) {
    case 'on-track':
      return 'status-on-track';
    case 'at-risk':
      return 'status-at-risk';
    case 'completed':
      return 'status-completed';
    default:
      return '';
  }
};

const getStatusLabel = (status: string) => {
  switch (status) {
    case 'on-track':
      return 'On Track';
    case 'at-risk':
      return 'At Risk';
    case 'completed':
      return 'Completed';
    default:
      return status;
  }
};

const formatDate = (dateStr: string) => {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

const getDaysUntilDeadline = (dateStr: string) => {
  const deadline = new Date(dateStr);
  const today = new Date();
  const diffTime = deadline.getTime() - today.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return diffDays;
};
---

<WikiLayout title="Goals Dashboard" description="Detailed goal progress and insights">
  <header class="page-header">
    <div class="header-content">
      <h1>Goals Dashboard</h1>
      <p class="page-description">Track goal progress, deadlines, and milestones</p>
    </div>
    <a href="/dashboard" class="back-button">‚Üê Back to Dashboard</a>
  </header>

  <!-- Summary Stats -->
  <div class="summary-grid">
    <div class="summary-card">
      <span class="summary-value">{goalsData.summary.activeGoals}</span>
      <span class="summary-label">Active Goals</span>
    </div>
    <div class="summary-card">
      <span class="summary-value">{goalsData.summary.completedGoals}</span>
      <span class="summary-label">Completed</span>
    </div>
    <div class="summary-card">
      <span class="summary-value">{goalsData.summary.averageProgress}%</span>
      <span class="summary-label">Avg Progress</span>
    </div>
    <div class="summary-card">
      <span class="summary-value">{goalsData.goals.filter(g => g.status === 'at-risk').length}</span>
      <span class="summary-label">At Risk</span>
    </div>
  </div>

  <!-- Goals List -->
  <section class="goals-section">
    <h2>Active Goals</h2>
    <div class="goals-list">
      {goalsData.goals.map((goal) => {
        const daysUntil = getDaysUntilDeadline(goal.deadline);
        const isUrgent = daysUntil < 8 && daysUntil > 0;
        const isOverdue = daysUntil < 0;

        return (
          <div class="goal-card">
            <div class="goal-header">
              <h3 class="goal-title">{goal.title}</h3>
              <span class={`goal-status ${getStatusColor(goal.status)}`}>
                {getStatusLabel(goal.status)}
              </span>
            </div>

            <div class="goal-meta">
              <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                </svg>
                <span>{goal.owner}</span>
              </div>
              <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span class={isOverdue ? 'deadline-overdue' : isUrgent ? 'deadline-urgent' : ''}>
                  {formatDate(goal.deadline)}
                  {isOverdue && ' (Overdue)'}
                  {isUrgent && !isOverdue && ` (${daysUntil}d left)`}
                </span>
              </div>
            </div>

            <div class="progress-section">
              <div class="progress-header">
                <span class="progress-label">Progress</span>
                <span class="progress-value">{goal.progress}%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style={`width: ${goal.progress}%`}></div>
              </div>
            </div>

            <div class="milestones-info">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
              </svg>
              <span>{goal.milestones.completed} / {goal.milestones.total} milestones completed</span>
            </div>
          </div>
        );
      })}
    </div>
  </section>
</WikiLayout>

<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-xl);
  }

  .header-content h1 {
    margin-bottom: var(--spacing-xs);
  }

  .page-description {
    color: var(--text-secondary);
    font-size: var(--text-base);
  }

  .back-button {
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    text-decoration: none;
    font-size: var(--text-sm);
    transition: all 0.2s ease;
  }

  .back-button:hover {
    border-color: var(--accent-color);
    background: var(--bg-hover);
  }

  /* Summary Grid */
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-2xl);
  }

  .summary-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--spacing-lg);
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
  }

  .summary-value {
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--text-primary);
  }

  .summary-label {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: var(--spacing-xs);
  }

  /* Goals Section */
  .goals-section h2 {
    margin-bottom: var(--spacing-lg);
  }

  .goals-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  .goal-card {
    padding: var(--spacing-lg);
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
  }

  .goal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-md);
  }

  .goal-title {
    margin: 0;
    font-size: var(--text-lg);
    color: var(--text-primary);
  }

  .goal-status {
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .status-on-track {
    background: rgba(22, 163, 74, 0.1);
    color: #16a34a;
  }

  .status-at-risk {
    background: rgba(234, 88, 12, 0.1);
    color: #ea580c;
  }

  .status-completed {
    background: rgba(107, 114, 128, 0.1);
    color: #6b7280;
  }

  /* Meta Info */
  .goal-meta {
    display: flex;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
    color: var(--text-secondary);
    font-size: var(--text-sm);
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
  }

  .meta-item svg {
    flex-shrink: 0;
    color: var(--text-muted);
  }

  .deadline-urgent {
    color: #ea580c;
    font-weight: 600;
  }

  .deadline-overdue {
    color: #dc2626;
    font-weight: 600;
  }

  /* Progress Bar */
  .progress-section {
    margin-bottom: var(--spacing-md);
  }

  .progress-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: var(--spacing-xs);
    font-size: var(--text-sm);
  }

  .progress-label {
    color: var(--text-secondary);
  }

  .progress-value {
    color: var(--text-primary);
    font-weight: 600;
  }

  .progress-bar {
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4263eb 0%, #818cf8 100%);
    border-radius: var(--radius-sm);
    transition: width 0.3s ease;
  }

  /* Milestones */
  .milestones-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    color: var(--text-secondary);
    font-size: var(--text-sm);
  }

  .milestones-info svg {
    flex-shrink: 0;
    color: var(--text-muted);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .summary-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .goal-header {
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .goal-meta {
      flex-direction: column;
      gap: var(--spacing-sm);
    }
  }
</style>
